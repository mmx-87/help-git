# Основы GIT. Основные команды.

[Возврат к Оглавлению](./README.md)

### **Содержание**
1. [Инициализация репозитория](#1.-инициализация-репозитория)
2. [Принцип работы с репозиторием](#2.-принцип-работы-с-репозиторием)
3. [Просмотр состояния репозитория](#3.-просмотр-состояния-репозитория)
4. [Добавление файла в индекс](#4.-добавление-файла-в-индекс)
5. [Внесение изменений в репозиторий. Комит](#5.-внесение-изменений-в-репозиторий-комит)
6. [Посмотреть сведения о комите](#6.-посмотреть-сведения-о-комите)
7. [Добавление файлов и каталогов](#7.-добавление-файлов-и-каталогов)
8. [Правильный комит](#8.-правильный-комит)
9. [Комиты без git add](#9.-комиты-без-git-add)
10. [Удаление и переименование файлов](#10.-удаление-и-переименование-файлов)

## 1. Инициализация репозитория
Команда:
```
git init
```
cоздаёт пустой GIT-репозиторий - каталог ".git" в корне проекта.

Репозиторий - это такое хранилище данных, которое содержит:
- всю базу данных об истории разработки проекта
- основные настройки самой системы GIT.

Если мы вдруг захотим отказаться от системы GIT, то достаточно будет удалить каталог ".git".


## 2. Принцип работы с репозиторием
В GIT ***двуступенчатая*** cистема внесения изменений

У нас есть 3 файловых зоны:
1. Рабочий каталог проекта
2. Индекс (в каталоге .git)

   хранит:
   - список отслеживаемых файлов проекта
   - промежуточные изменения этих файлов

3. Собственно Репозиторий (в каталоге .git)

   хранит:
   - всю историю разработки проекта

Если мы хотим, чтобы GIT следил за изменениями файла, то добавляем файл в индекс.


Когда мы доделали какую-то часть работы, то мы фиксируем изменения из индекса в репозитории.

> Почему процесс ввода изменений двуступенчатый?

В процессе разработки достаточна типична ситуация, когда в рабочем каталоге много изменений, которые связаны с разными задачами. Например, в рамках работы вы что-то сначала поправили в системе авторизации, а затем в системе оплаты. Такие изменения нужно вносить по-отдельности.
Если вы внесли изменения в репозиторий совместно, то откатывать изменения придётся тоже сразу на всё - и на то что работает, и на то что не работает, что довольно неудобно.


## 3. Просмотр состояния репозитория
Команда:
```
 git status
```
выводит состояние репозитория - состояние файлов нашего проекта с точки зрения GIT.

untracked files - неотслеживаемые файлы, т.е. это файлы, которые отсутствует в индексе, и GIT за ними не следит.


## 4. Добавление файла в индекс
Команда:
```
 git add "filename"
```
добавляет файл "filename" в индекс, т.е. теперь файл "filename" проиндексирован, и команда git status теперь покажет, что такой файл у нас есть и GIT следит за ним.

```
 git add -p
```
позволяет индексировать не весь файл, а только некоторые изменения из него, которые мы можем зафиксировать (внести в репозиторий) отдельно.


## 5. Внесение изменений в репозиторий. Комит
Чтобы окончательно записать файл "filename" в репозиторий, мы используем комманду:
```
 git commit
```
запустится [текстовый редактор](./config.md) с открытым файлом. В этом файле мы должны добавить сообщение о том, какие по сути мы вносим изменения в репозиторий. Первая строка записи изменений должна быть небольшой (обычно не более 50 символов) и довольно ёмко и при этом кратко описывать суть изменений.

Фиксацию изменений в репозитории так и принято называть - **commit** (комит)

у комита есть хеш (идентификатор) - 16-ричное число

по хешу мы можем:
- посмотреть:   
   - какие изменения в проект внёс комит
   - кто и когда сделал эти изменения
- получить
   - файлы на момент этого комита


команда
```
git commit -m 'Главное сообщение о комите'
```
делает комит без вызова редактора кода. В таком случае в качестве параметра ключа -m используется та самая первая строка, кратко описывающая суть комита. 

### **Сохранение прав на файл:**

*git commit* также сохраняет в правах на файл сведения о возможности выполнения этого файла для пользователя.

>для git характерны права доступа, используемые для ОС Linux. Но в файловой системе Windows права на файл используются по-другому.

Чтобы файл был исполняемым в любой ОС, мы можем поставить исполнимый бит для файла напрямую в индекс GIT в обход файловой системы:
```
git update-index --chmod=+x filename
```
для существующего файла.

Либо указать при добавлении нового файла в индекс:
```
git add --chmod=+x filename
```

## 6. Посмотреть сведения о комите
Команда
```
 git show --pretty=fuller хеш_комита
```
## 7. Добавление файлов и каталогов
>GIT не умеет добавлять в индекс пустые каталоги! 

Команда:
```
 git add .
```
добавляет в индекс все файлы и подкаталоги относительно текущего каталога. Поэтому лучше воспользуйтесь командой:
```
 git add -A
```
добавляет в индекс все файлы и подкаталоги проекта. 

Команда
```
 git reset HEAD файл_или_каталог
```
сбрасывает/удаляет изменения в индексе

Если мы внесли изменения в файл уже после проиндексированных изменений, то их обычно нужно добавить еще раз вызвав git add

Если мы не хотим добавлять какие-то файлы в проект, то их надо отметить в файле .gitignore в корне проекта

## 8. Правильный комит
> Как правильно версионировать изменения

Несвязные между собой изменения в проекте лучше индексировать и комитить по отдельности

**АТОМАРНОСТЬ**
очень важдно, чтобы комит делал _только одну_ вещь, например:
- комит, исправляющий какую-то одну ошибку
- комит, добавляющий какую-то одну функцию

**КОНСИСТЕНТНОСТЬ** (ЦЕЛОСТНОСТЬ)

Это - логическая завершенность изменения.

Например, необходимо изменить имя функции в коде, но также в рамках этого же комита надо поправить все места, гед данная функция вызывается

> Благодаря такому подходу - небольшим целостным комитам, ими легко манипулировать, откатывать изменения, исправлять код.

## 9. Комиты без git add
Каждый раз вызывать 2 команды
```
 git add
 git commit
```
не очень то удобно.

В простых случаях можно
1. Если вы зашли в проект с чистым статусом (git status) и внесли связанные между собой небольшие изменений, то можно обойтись
   ```
    git commit -a -m '...'
   ```
   но так не будут отслеживаться файлы, которых еще не было ранее в индексе.

2. Можно закомитить отдельный файл (ранее не индексированный)
   ```
    git commit -m '...' "filename"
   ```
3. Использовать алиас (псевдоним)
   ```
   git config --global alias.commitall 'git add -A; git commit'
   ```
   и далее
   ```
   git commitall -m '...'
   ```
   но лучше таким не заниматься.

## 10. Удаление и переименование файлов

### 1. Удаление
Файл будет удален только для текущего состояния репозитория - в истории разработки он останется и его можно будет опднять, обратившись к ранним комитам.

3 варианта:

   1. 1. Удаляем сам файл
      2. "Добавляем" его в индекс
      3. commit   
   2. 
      ```
       git rm -r 'dir'
       или
       git rm 'file'
      ```
      т.е. по сути rm + git add

   3.
      ```
      git rm --cached 'file'
      ```
      удалит файл из индекса, но оставит в рабочем каталоге.

      флаг --cached означает, что работать надо только с индексом, не трогая рабочий каталог

      флаг -f - игнорировать предупреждения и заставить выполнить операцию.

### 2. Переименование
> Переименования не существует! ;-)
```
 mv filename1 filename2
 git status
```
покажет, что 
- был удален файл
- обнаружен неотслеживаемый файл

после
```
git add .
git status
```
GIT покажет, что файл был переименован. Т.к. файл добавили в индекс, то GIT, проанализировав содержимое, догадался, что было переименование.

Поэтому все дружно пользуемся:
```
git mv filename1 filename2
```

